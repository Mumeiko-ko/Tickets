# 無名子大王搶票小幫手

一個專為拓元售票網（Tixcraft）設計的 Chrome 擴充功能。

## ✨ 主要功能

### 🤖 智能搶票系統

- **自動場區選擇**：根據關鍵字智能匹配目標場區
- **自動票數選擇**：選擇所需張數（1-4 張）
- **自動驗證碼識別**：整合 ddddocr 技術，自動解析驗證碼，辨識能力有限，對手速有自信的可以使用半自動模式手動輸入驗證碼
- **無限重試機制**：驗證碼錯誤時自動重試

### 🎯 雙模式操作

- **全自動模式**：一鍵啟動，從搶票到完成全程自動化
- **半自動模式**：驗證碼需手動輸入，其他步驟自動執行

## 安裝說明

### 方法一：自動安裝（推薦）

#### Windows 用戶

```bash
# 雙擊執行
install.bat
```

#### Linux/macOS 用戶

```bash
# 在終端中執行
chmod +x install.sh
./install.sh
```

### 方法二：手動安裝

#### 1. 安裝 Python 依賴

```bash
pip install ddddocr flask flask-cors
```

#### 2. 載入 Chrome 擴充功能

1. 打開 Chrome 瀏覽器
2. 輸入 `chrome://extensions/`
3. 開啟「開發者模式」
4. 點擊「載入未封裝項目」
5. 選擇此專案資料夾

#### 3. 啟動驗證碼識別 API

```bash
python api_server.py
```

## 🚀 使用教學

### 步驟 1：準備工作

1. 確保驗證碼 API 已啟動（終端顯示 `Running on http://0.0.0.0:9988`）
2. 登入拓元售票網並進入搶票頁面
3. 點擊瀏覽器右上角的擴充功能圖示

### 步驟 2：設定參數

1. **場區關鍵字**：輸入目標場區的關鍵字（例如：「搖滾」、「VIP」）
2. **票數選擇**：選擇要搶的張數（1-4 張）
3. **模式選擇**：
   - 關閉半自動模式：全程自動執行
   - 開啟半自動模式：驗證碼需手動輸入

### 步驟 3：開始搶票

1. 點擊「🚀 戰爭開始」按鈕
2. 觀察右上角日誌面板的執行狀況
3. 需要時可點擊「⏹️ 戰爭結束」停止

### 步驟 4：完成購票

- 搶票成功後會自動跳轉至購票頁面
- 請手動填寫購票資訊並完成付款

## 📁 檔案結構

```
📦 tickets/
├── 📄 README.md              # 專案說明文檔
├── 📄 manifest.json          # Chrome擴充功能清單
├── 📄 content.js            # 主程式腳本
├── 📄 popup.html            # 彈出視窗頁面
├── 📄 popup.js              # 彈出視窗腳本
├── 📄 api_server.py         # 驗證碼識別API服務
├── 🖼️ bird.png              # 擴充功能圖示
├── 📄 install.bat           # Windows自動安裝腳本
├── 📄 install.sh            # Linux/macOS自動安裝腳本
└── 📁 ddddocr/              # 驗證碼識別模組
    ├── 📄 __init__.py
    ├── 📄 requirements.txt
    └── 📁 api/
        ├── 📄 server.py
        ├── 📄 models.py
        └── 📄 routes.py
```

## ⚙️ 進階設定

### API 伺服器設定

預設 API 服務運行在 `http://localhost:9988`，如需修改請編輯：

- `api_server.py` 中的 `port` 參數
- `content.js` 中的 API 請求網址

### 搶票邏輯調整

可在 `content.js` 中自訂：

- 重試間隔時間
- 驗證碼輸入延遲
- 場區匹配邏輯

## 🔧 核心檔案說明

### `manifest.json`

Chrome 擴充功能的配置檔案，定義了：

- 擴充功能基本信息（名稱、版本、描述）
- 權限設定（activeTab、scripting、storage）
- 內容腳本注入設定
- 圖示配置

### `content.js`

搶票腳本的核心邏輯，包含：

- **UI 控制面板**：美觀的設定界面和即時日誌
- **路由系統**：自動識別活動頁、場區選擇頁、票券頁
- **場區選擇邏輯**：支持多種 HTML 結構，智能匹配關鍵字
- **驗證碼處理**：全自動識別 + 半自動手動輸入雙模式
- **錯誤處理**：完善的重試機制和錯誤恢復

### `api_server.py`

驗證碼識別 API 伺服器：

- 使用 ddddocr 進行 OCR 識別
- 提供 Flask HTTP API 接口
- 支援 Base64 圖片格式
- CORS 跨域支援

### `popup.html` & `popup.js`

擴充功能的彈出視窗界面：

- 提供快速設定選項
- 顯示運行狀態
- 一鍵啟動/停止功能

## 🚀 快速安裝

### 方法一：自動安裝（推薦）

**Windows 用戶：**

```bash
# 下載專案後，雙擊執行
install.bat
```

**Linux/Mac 用戶：**

```bash
# 給予執行權限並運行
chmod +x install.sh
./install.sh
```

### 方法二：手動安裝

1. **安裝 Python 依賴**

```bash
pip install ddddocr
pip install Flask
pip install flask-cors
```

2. **載入 Chrome 擴充功能**

   - 打開 Chrome 瀏覽器
   - 前往 `chrome://extensions/`
   - 開啟「開發者模式」
   - 點擊「載入未封裝項目」
   - 選擇專案資料夾 `d:\CODE\tickets\`

3. **啟動驗證碼識別服務**

```bash
python api_server.py
```

## 📖 使用說明

### 1. 準備工作

- 確保 Chrome 擴充功能已安裝並啟用
- 啟動驗證碼識別 API 服務（`python api_server.py`）
- 登入拓元售票網站

### 2. 設定參數

在網頁右上角的控制面板中設定：

- **場區關鍵字**：例如「搖滾」、「VIP」、「1F」
- **票券數量**：選擇 1-4 張
- **模式選擇**：
  - ✅ 全自動模式：完全自動化，包含驗證碼識別
  - ✅ 半自動模式：手動輸入驗證碼，其餘自動

### 3. 開始搶票

1. 進入活動頁面
2. 點擊「🚀 戰爭開始」按鈕
3. 腳本會自動：
   - 點擊「立即購票」
   - 選擇符合關鍵字的場區
   - 選擇票券數量
   - 處理驗證碼（自動識別或等待手動輸入）
   - 提交訂單

### 4. 監控過程

- 右上角面板會即時顯示執行日誌
- 綠色訊息表示成功操作
- 紅色訊息表示錯誤或警告
- 藍色訊息表示一般資訊

## 🎯 搶票策略

### 場區選擇策略

1. **關鍵字匹配**：優先選擇包含關鍵字的場區
2. **可用性檢查**：自動跳過已售完的場區
3. **智能回退**：如無完全匹配，選擇第一個可用場區
4. **多結構支援**：適配不同活動的頁面結構

### 驗證碼處理策略

- **全自動模式**：使用 OCR 快速識別，失敗時自動更換驗證碼
- **半自動模式**：等待手動輸入，確保準確性
- **錯誤檢測**：自動檢測提交結果，失敗時重新處理
- **無限重試**：直到成功或手動停止

## ⚙️ 系統需求

- **瀏覽器**：Chrome 88+ 或其他 Chromium 內核瀏覽器
- **Python**：3.7+ 版本
- **網路**：穩定的網際網路連線
- **系統**：Windows、Linux、或 macOS

## � 疑難排解

### 常見問題

#### Q1：驗證碼識別失敗

**解決方案：**

- 確認 `api_server.py` 正在運行
- 檢查防火牆是否阻擋 9988 端口
- 切換到半自動模式手動輸入

#### Q2：找不到目標場區

**解決方案：**

- 檢查場區關鍵字是否正確
- 嘗試使用更短的關鍵字
- 確認頁面已完全載入

#### Q3：腳本無法啟動

**解決方案：**

- 重新整理頁面後再試
- 檢查 Chrome 擴充功能是否正確載入
- 查看瀏覽器控制台是否有錯誤訊息

#### Q4：搶票速度太慢

**解決方案：**

- 確認已關閉所有不必要的瀏覽器標籤
- 使用穩定快速的網路連線
- 考慮使用性能更好的電腦

### 錯誤代碼對照

| 錯誤代碼       | 說明         | 解決方案                 |
| -------------- | ------------ | ------------------------ |
| API_TIMEOUT    | API 請求超時 | 檢查 API 服務狀態        |
| AREA_NOT_FOUND | 找不到場區   | 調整關鍵字或檢查頁面     |
| CAPTCHA_ERROR  | 驗證碼錯誤   | 自動重試或切換半自動模式 |
| NETWORK_ERROR  | 網路連線問題 | 檢查網路連線狀態         |

## 🛡️ 安全須知

1. **僅供學習**：本工具僅供技術學習和研究使用
2. **遵守規則**：請遵守各售票網站的使用條款
3. **合理使用**：避免過度頻繁的請求造成伺服器負擔
4. **個人責任**：使用者需自行承擔使用風險

## � 更新日誌

### v1.0.0 (2025/06/17)

- ✅ 初始版本發布
- ✅ 基本搶票功能
- ✅ 驗證碼自動識別
- ✅ 雙模式操作
- ✅ 現代化 UI 設計
- ✅ 自動安裝腳本

### 開發環境

```bash
# 克隆專案
git clone [repository-url]

# 安裝依賴
pip install -r requirements.txt

# 啟動開發伺服器
python api_server.py
```

## 🙏 致謝

- [ddddocr](https://github.com/sml2h3/ddddocr) - 優秀的驗證碼識別庫
- [Flask](https://flask.palletsprojects.com/) - 輕量級 Web 框架
- Chrome Extensions API - 強大的瀏覽器擴充功能支援

---

**祝您搶票成功！** 🎉
