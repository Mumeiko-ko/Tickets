無名子自動搶票小幫手

一個專為拓元售票網（Tixcraft）設計的 Chrome 擴充功能。

## 主要功能

- 自動場區選擇：根據關鍵字選擇目標場區
- 自動票數選擇：選擇所需張數（1-4 張）
- 演出日期選擇：可指定特定演出日期，自動點擊對應的「立即訂購」按鈕
- 自動驗證碼識別：整合 ddddocr 技術，自動辨識驗證碼，辨識有限可切換半自動
- 無限重試機制：驗證碼錯誤時自動重試
- 全自動/半自動雙模式
- 定時搶票：可預約搶票時間，自動倒數並於指定時間啟動搶票流程

## 安裝說明

### 自動安裝（推薦）

Windows：雙擊 install.bat

Linux/macOS：

```
chmod +x install.sh
./install.sh
```

### 手動安裝

1. 安裝 Python 依賴

```
pip install ddddocr flask flask-cors
```

2. 載入 Chrome 擴充功能

   - 打開 Chrome，進入 chrome://extensions/
   - 開啟「開發者模式」
   - 點「載入未封裝項目」選擇本資料夾

3. 啟動驗證碼 API

```
python api_server.py
```

## 使用教學

1. 啟動驗證碼 API（終端顯示 9988）
2. 登入拓元售票網，點右上角擴充功能圖示
3. 設定場區關鍵字、票數、模式
4. 設定「演出日期」（可選）：
   - 選擇特定日期後會自動點擊對應的立即訂購按鈕
   - 如果目標日期顯示已售完，系統會自動重新整理頁面並重試（最多 15 次）
   - 支援多種日期格式識別，包含中文、數字、星期等格式
5. 設定「定時搶票」時間，面板會自動倒數並於指定時間啟動（可選）
6. 點「戰爭開始」即可自動搶票
7. 右上角日誌面板可監控狀態與倒數

### 自動重試機制

- **無限重試模式**：找不到按鈕、已售完、點擊失敗等情況會無限重試直到成功
- **快速重新整理**：重試間隔縮短至 200-800ms 隨機時間，提升搶票速度
- **智慧等待**：每次重新開始處理間隔 500ms，確保頁面載入完成

## 專案結構

```
src/config/constants.js         # 常數配置
src/utils/helpers.js            # 工具函式
src/ui/floatingPanel.js         # 浮動控制面板
src/pages/areaSelection.js      # 區域選擇頁面邏輯
src/pages/ticketQuantity.js     # 票券數量頁面邏輯
src/services/captchaService.js  # 驗證碼處理服務
src/services/dateSelection.js   # 演出日期選擇服務
src/services/scheduledTicketing.js # 定時搶票服務
src/services/timesync.js        # 時間同步服務
src/core/mainRouter.js          # 主路由控制器
content.js                      # 主入口檔案
content_original.js             # 原始檔案備份
manifest.json                   # 擴充功能配置
```

## 進階設定

- API 服務預設 http://localhost:9988
  可於 api_server.py 及 content.js 調整
- 票務流程、重試間隔、驗證碼延遲等可於 content.js 調整

## 技術架構

- manifest.json：Chrome 擴充功能配置，模組化內容腳本注入
- content.js：主入口，初始化 UI 與主流程
- api_server.py：驗證碼識別 API（Flask + ddddocr）
- popup.html/popup.js：彈出視窗設定

## 常見問題

- 驗證碼識別失敗：確認 api_server.py 運行，或切換半自動
- 找不到場區：檢查關鍵字、頁面是否載入
- 腳本無法啟動：重整頁面、檢查擴充功能
- 搶票慢：關閉多餘分頁、確保網路穩定

## 更新日誌

- v2.2.6 (2025/06/22)

  - 加強錯誤處理：改進驗證碼識別失敗時的重試邏輯
  - 增強日誌記錄：記錄驗證碼處理過程和錯誤

- v2.2.5 (2025/06/22)

  - 修復定時搶票功能：解決定時搶票執行時讀取不到搶票設定的問題
  - 優化設定保存機制：定時搶票設定時自動保存搶票參數到 Chrome Storage
  - 增強錯誤日誌：詳細記錄定時搶票執行過程與錯誤
  - 確保定時搶票與手動搶票使用相同的設定

- v2.2.4 (2025/06/22)

  - 精確場區匹配：僅選擇關鍵字選定的場區，避免誤選或錯選
  - 防止導向錯誤：發現非目標場區時自動重新整理，不進行選擇
  - 優化日誌顯示：詳細記錄場區選擇過程與重試原因
  - UI 提示增強：新增場區選擇精確匹配說明

- v2.2.3 (2025/06/22)

  - 極速化重試機制：重新整理等待時間進一步縮短隨機間隔
  - 加速重新開始處理：統一縮短間隔

- v2.2.2 (2025/06/22)

  - 重試機制大幅優化：改為無限重試直到成功，不再有重試次數限制
  - 大幅縮短重新整理等待時間：從 1-3 秒縮短至 200-800ms 隨機間隔
  - 優化重新開始處理時間：從 1.5-2 秒縮短至 500ms 統一間隔
  - 提升搶票整體速度和穩定性，增加搶票成功機率

- v2.2.1 (2025/06/22)

  - 修復找不到立即訂購按鈕時頁面不會自動重新整理的問題
  - 加強按鈕搜尋邏輯，新增廣泛搜尋模式，降低找不到按鈕的機率
  - 優化日誌輸出，顯示頁面總按鈕數量和搜尋過程
  - 放寬按鈕識別條件，支援更多類型的購票元素

- v2.2.0 (2025/06/22)

  - 新增已售完自動重試功能，選定演出日期顯示已售完時會自動重新整理頁面重試
  - 增強日期選擇服務的已售完檢測機制，支援多種售完狀態識別
  - 優化重試邏輯，區域選擇和日期選擇分別設定重試次數（10 次/15 次）
  - 加強購票按鈕過濾機制，有效排除「訂單查詢」等無關連結

- v2.1.0 (2025/06/22)

  - 新增演出日期選擇功能，可指定特定演出日期自動點擊對應按鈕
  - 完善日期選擇服務與主流程整合
  - 優化浮動面板 UI，加入日期選擇提示
  - 增強日期格式識別（支援多種中文、英文日期格式）

- v2.0.0 (2025/06/20) - 改善點下啟動搶票後的速度，增加定時搶票功能，改善 UI 顯示
- v1.2.0 (2025/06/18) - 模組化重構，主程式拆分為多檔案，維持原有功能與速度
- v1.0.0 (2025/06/17) - 初始版本

## 致謝

ddddocr、Flask、Chrome Extensions API

祝您搶票成功！
